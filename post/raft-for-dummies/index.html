<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Raft for Dummies and those like me. | Lars Cromley</title><link rel=stylesheet href=https://cromleylabs.com/css/style.css><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/github.min.css><section class=section><div class=container><nav class=nav><div class=nav-left><a class=nav-item href=https://cromleylabs.com><h1 class="title is-4">Lars Cromley</h1></a></div><div class=nav-right><nav class="nav-item level is-mobile"><a class=level-item href=/about><span class=icon><i class="fa fa-id-badge"></i></span></a><a class=level-item href=/disclaimer><span class=icon><i class="fa fa-exclamation-circle"></i></span></a><a class=level-item href=https://github.com/callmeradical><span class=icon><i class="fa fa-github"></i></span></a><a class=level-item href=https://twitter.com/callmeradical><span class=icon><i class="fa fa-twitter"></i></span></a><a class=level-item href=/index.xml><span class=icon><i class="fa fa-rss"></i></span></a></nav></div></nav></div></section><section class=section><div class=container><h2 class="subtitle is-6">September 11, 2016</h2><h1 class=title>Raft for Dummies and those like me.</h1><div class=content><p>This is going to be my very feeble attempt to explain the Raft consensus algorithm. The very least I will accomplish is sharing the material I have read about Raft and how I have come to understand it. Raft is used in popular pieces of software such as RethinkDB, etcd, and a number of Hashicorp products.(<sup class=footnote-ref id=fnref:1><a href=#fn:1>1</a></sup>)</p><h3 id=what-is-raft>What is Raft?</h3><p>Raft was developed in the hopes of creating an easy to understand consensus algorithm. As far as that goes, I think they succeeded, especially when compared with similiar algorithms, such as <a href=https://en.wikipedia.org/wiki/Paxos_(computer_science)>Paxos</a>(I am still working this one out). Consensus algorithms allow a collection of machines to work as a coherent group that can survive the failures of some of its members.(<sup class=footnote-ref id=fnref:2><a href=#fn:2>2</a></sup>)</p><p>To really understand this, lets take a step back and talk about what makes up a distributed system. Wikipedia has a really great definition on the <a href=https://en.wikipedia.org/wiki/Distributed_computing>Distributed Computing page</a>:</p><blockquote><p>A distributed system is a model in which components located on networked computers communicate and coordinate their actions by passing messages.</p></blockquote><p>The consensus algorithm is how these computers coordinate their actions. Implementing a consensus algorithm is typically necessary in the context of <em>replicated state machines</em>.</p><p>A common implementation of a replicated state machine, uses a replicated log. In otherwords, the following is true:</p><ul><li>Multiple logs containing a series of commands or transactions.</li><li>Each log must contain the same instructions in the same order.</li><li>Each machine processes the same sequence of commands.</li></ul><p>A commonplace example of this, at least in most enterprise shops, is Zookeeper. Zookeeper is an example of a replicated state machine.<img src=https://dl.dropboxusercontent.com/s/eahsi12m5jov22u/statemachine.png alt="cloudcraft - RSM (1)"></p><p>This is the basic design of state machine architecture. Client sends a message to the consensus module, the consensus module replicates the transaction to multiple logs, the state machine reads from the logs and returns the value or transaction back to the client.</p><p>The log is very important. The consensus algorithm is the manner in which we keep the replicated log consistent. The consensus module on a node receives instructions from clients, adds them to its log, and it communicates to other servers to ensure that every log eventually contains all requests in the in which they were received, even if some servers fail. After the commands are properly replicated, each server&rsquo;s state machine processes them in log order, and output is returned to the client nodes. The outcome, is a system that appears to be a single, highly reliable, state machine. This is true with the exception of Byzantine conditions(<sup class=footnote-ref id=fnref:3><a href=#fn:3>3</a></sup>) (network delays, partitions, packet loss, duplication, and reordering).</p><p>In Raft a node can be in 1 of 3 states:</p><ul><li>The Follower state</li><li>The Candidate state</li><li>The Leader state</li></ul><p>All nodes start in the follower state. If Followers don&rsquo;t hear from a leader then they can become a candidate. The candidate then requests votes from other nodes. Nodes reply with their vote. The candidate becomes the leader if it gets votes from a majority of nodes. This is the process called <em>Leader Election</em>. All changes now flow through the leader. Each change is added as an entry in the node&rsquo;s log. The log entry is uncommitted and as such will not update the node&rsquo;s value, instead, the node first replicates it to the follower nodes, then the leader waits until a majority of nodes have written the entry, and is then committed to the leader node. The leader then notifies the followers that the entry is committed. The cluster has then come to a consensus. This is log replication.</p><p>Leader Election</p><p>In Raft there are two timeout settings which control elections, <em>Election Timeout</em>, and <em>Heartbeat Timeout</em>.</p><p>Election timeout is the amount of time a follower waits until becoming a candidate. Election timeout is randomized to be between 150 ms and 300 ms. After the election timeout the follower becomes a candidate and starts a new election term, votes for itself, and sends out Request Vote messages to other nodes. If the receiving node hasn&rsquo;t voted yet in this term then it votes for the candidate, and the node resets its election timeout. Once a candidate has a majority of votes it becomes leader.</p><p>The leader begins sending out Append Entries messages to its followers. These messages are sent in intervals specified by the heartbeat timeout. Followers then respond to each Append Entries message. This election term will continue until a follower stops receiving heartbeats and becomes a candidate. Requiring a majority of votes guarantees that only one leader can be elected per term. If two nodes become candidates at the same time then a split vote can occur. In the event of a split vote, say we had four nodes, two nodes both start an election for the same term, and each reaches a single follower node before the other. Now each candidate has 2 votes and can receive no more for this term. The nodes will wait for a new election and try again. This will continue until majority is reached.(<sup class=footnote-ref id=fnref:4><a href=#fn:4>4</a></sup>)</p><p>Raft was created to be easier to understand than Paxos. There is a conference specifically for systems design called the NSDI (Networked Systems Design and Implementation) and someone there even voiced concern about people understanding all components of Paxos. Claiming that there only 5 people are the conference that understood it completely. Whether or not that is true. I can say for sure, Raft is definitely easier to understand and has succeeded in that mission.</p><h3 id=references>References</h3><div class=footnotes><hr><ol><li id=fn:1><a href=https://raft.github.io/#implementations>Raft Implementations</a> |
<a class=footnote-return href=#fnref:1><sup>[return]</sup></a></li><li id=fn:2><a href=https://raft.github.io/raft.pdf>In Search of an Understandable Consesus Algorithm</a> |
<a class=footnote-return href=#fnref:2><sup>[return]</sup></a></li><li id=fn:3><a href=https://en.wikipedia.org/wiki/Byzantine_fault_tolerance>Byzantine fault tolerance</a> |
<a class=footnote-return href=#fnref:3><sup>[return]</sup></a></li><li id=fn:4><a href=http://thesecretlivesofdata.com/raft/#home>The Secret Lift of Data - Raft</a> |
<a class=footnote-return href=#fnref:4><sup>[return]</sup></a></li></ol></div></div></div></section><section class=section><div class=container><aside><div id=disqus_thread></div></aside><script type=text/javascript>var disqus_shortname='callmeradical';(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div></section><section class=section><div class="container has-text-centered"><p>&copy; <a href=https://github.com/callmeradical>Lars Cromley</a> 2017</p></div></section><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js></script><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/languages/go.min.js></script><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/languages/dockerfile.min.js></script><script>hljs.initHighlightingOnLoad();</script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-159931755-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script>