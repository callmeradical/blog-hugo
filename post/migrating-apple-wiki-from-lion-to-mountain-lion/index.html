<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Migrating Apple Wiki from Lion to Mountain Lion | Lars Cromley</title><link rel=stylesheet href=https://cromleylabs.com/css/style.css><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/github.min.css><section class=section><div class=container><nav class=nav><div class=nav-left><a class=nav-item href=https://cromleylabs.com><h1 class="title is-4">Lars Cromley</h1></a></div><div class=nav-right><nav class="nav-item level is-mobile"><a class=level-item href=/about><span class=icon><i class="fa fa-id-badge"></i></span></a><a class=level-item href=/disclaimer><span class=icon><i class="fa fa-exclamation-circle"></i></span></a><a class=level-item href=https://github.com/callmeradical><span class=icon><i class="fa fa-github"></i></span></a><a class=level-item href=https://twitter.com/callmeradical><span class=icon><i class="fa fa-twitter"></i></span></a><a class=level-item href=/index.xml><span class=icon><i class="fa fa-rss"></i></span></a></nav></div></nav></div></section><section class=section><div class=container><h2 class="subtitle is-6">November 25, 2013</h2><h1 class=title>Migrating Apple Wiki from Lion to Mountain Lion</h1><div class=content><p>Well here is the first post to this blog with some substance to it!</p><p>Here is a little backstory on the situation. I found myself almost immediately scouring the internet one morning when my boss had told me there was a problem with our server (at this point in time it was our only server) that was currently running OS X 10.7, Lion. I was not a fan of Lion server as it was a major departure from the server OS we all knew and loved. I was initially brought in to move to a virtual infrastructure in a vCenter managed environment. After many internet searches turned up incomplete instructions I figured I would post the exact steps I went through the get the job done.<hr></hr></p><p>These are the steps that were necessary to migrate information from OS X 10.7 Lion (Tamman Server) to OS X 10.8 Mountain Lion (TMN108SVR-1)
First step is done on the source OS X server, perform this command in Terminal as an administrator this will dump the Postgres database to a file:</p><pre><code class=language-bash>sudo pg_dump --format=c --compress=9 --blobs --username=collab --file=/tmp/collab.pgdump collab
</code></pre><p>Once that finishes, copy /tmp/collab.pgdump from the source server to /tmp/collab.pgdump on the destination server, then copy the contents of /Library/Server/Wiki/FileData on the source server to /Library/Server/Wiki/FileData on the destination server.</p><p>*** Note: you may also need to copy /usr/share/collabd/server to the destination server (see below)</p><p>Log in to the destination server as an administrator and execute the following commands in Terminal to ensure correct ownership and permissions, start the Postgres database, populate it with the data dumped from the source server, and finally start up the wiki service:</p><pre><code class=language-bash>sudo chown -R _teamsserver:_teamsserver /Library/Server/Wiki/FileData
sudo chmod -R +a &quot;www allow read&quot; /Library/Server/Wiki/FileData
sudo serveradmin stop wiki
sudo serveradmin start postgres
sudo rake -f /usr/share/collabd/server/Rakefile db:drop
sudo serveradmin stop wiki
sudo serveradmin start postgres
sudo rake -f /usr/share/collabd/server/Rakefile db:drop
</code></pre><p>This file may not be present and needs to be created on the server in order for this last command to complete successfully. This is why we copy the directory and files from the previous install.</p><pre><code class=language-bash>sudo createuser -U _postgres -d -s collab
sudo createdb -U collab collab
sudo -u _postgres pg_restore -d collab -U collab --single-transaction /tmp/collab.pgdump
sudo serveradmin start wiki
</code></pre><p>** Important: These steps will cause any wikis already present on the destination server to be lost.
Note: Migrating wikis does not migrate users or groups. This will either have to been done as an Open Directory or Active Directory.</p></div></div></section><section class=section><div class=container><aside><div id=disqus_thread></div></aside><script type=text/javascript>var disqus_shortname='callmeradical';(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div></section><section class=section><div class="container has-text-centered"><p>&copy; <a href=https://github.com/callmeradical>Lars Cromley</a> 2017</p></div></section><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js></script><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/languages/go.min.js></script><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/languages/dockerfile.min.js></script><script>hljs.initHighlightingOnLoad();</script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-159931755-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script>